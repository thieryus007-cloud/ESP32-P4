<section id="tab-config" class="tab-panel" aria-labelledby="tab-config-label">
  
  <!-- Header avec statut -->
  <div class="card card-stacked mb-4">
    <div class="card-header flex-wrap align-items-center gap-3">
      <div>
        <h3 class="card-title mb-0">
          <i class="ti ti-settings-cog me-2"></i>
          Configuration ESP32-CAN-X2
        </h3>
        <p class="card-subtitle text-secondary mb-0">
          Paramétrage du module ESP32 : UART, Wi-Fi et bus CAN Victron.
        </p>
      </div>
      <div class="ms-auto d-flex flex-wrap align-items-center gap-2">
        <button id="config-refresh" class="btn btn-outline-primary btn-sm">
          <i class="ti ti-refresh me-1"></i>
          Rafraîchir
        </button>
        <span id="config-status" class="badge bg-secondary-lt text-secondary" aria-live="polite">
          Chargement...
        </span>
      </div>
    </div>
  </div>

  <!-- Navigation par onglets -->
  <ul class="nav nav-tabs nav-fill mb-4" id="esp32-config-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="device-uart-tab" data-bs-toggle="tab" 
              data-bs-target="#device-uart" type="button" role="tab" 
              aria-controls="device-uart" aria-selected="true">
        <i class="ti ti-device-mobile me-2"></i>
        Appareil & UART
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="wifi-sta-tab" data-bs-toggle="tab" 
              data-bs-target="#wifi-sta" type="button" role="tab" 
              aria-controls="wifi-sta" aria-selected="false">
        <i class="ti ti-wifi me-2"></i>
        Wi-Fi Station
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="wifi-ap-tab" data-bs-toggle="tab" 
              data-bs-target="#wifi-ap" type="button" role="tab" 
              aria-controls="wifi-ap" aria-selected="false">
        <i class="ti ti-router me-2"></i>
        Wi-Fi Point d'Accès
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="can-bus-tab" data-bs-toggle="tab" 
              data-bs-target="#can-bus" type="button" role="tab" 
              aria-controls="can-bus" aria-selected="false">
        <i class="ti ti-network me-2"></i>
        Bus CAN Victron
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="identity-tab" data-bs-toggle="tab" 
              data-bs-target="#identity" type="button" role="tab" 
              aria-controls="identity" aria-selected="false">
        <i class="ti ti-id me-2"></i>
        Identité Victron
      </button>
    </li>
  </ul>

  <!-- Contenu des onglets -->
  <div class="tab-content" id="esp32-config-content">
    
    <!-- Onglet 1: Appareil & UART -->
    <div class="tab-pane fade show active" id="device-uart" role="tabpanel" aria-labelledby="device-uart-tab">
      <form id="device-uart-form">
        <div class="card bg-dark border border-secondary">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="ti ti-device-mobile me-2"></i>
              Configuration Appareil & UART
            </h4>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6 col-xl-3">
                <label for="device-name" class="form-label">
                  <span>Nom du dispositif</span>
                </label>
                <input id="device-name" name="device_name" type="text" 
                       class="form-control" maxlength="64" required>
                <div class="form-hint text-muted small">
                  Nom pour identifier le module
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="uart-poll-interval" class="form-label">
                  <span>Intervalle sondage UART (ms)</span>
                </label>
                <input id="uart-poll-interval" name="uart_poll_interval_ms" 
                       type="number" class="form-control" 
                       min="100" max="600000" step="10" required>
                <div class="form-hint text-muted small">
                  100 - 600 000 ms
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="uart-tx-gpio" class="form-label">
                  <span>GPIO UART TX</span>
                </label>
                <input id="uart-tx-gpio" name="uart_tx_gpio" 
                       type="number" class="form-control" 
                       min="-1" max="48" required>
                <div class="form-hint text-muted small">
                  Broche TX: -1 à 48
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="uart-rx-gpio" class="form-label">
                  <span>GPIO UART RX</span>
                </label>
                <input id="uart-rx-gpio" name="uart_rx_gpio" 
                       type="number" class="form-control" 
                       min="-1" max="48" required>
                <div class="form-hint text-muted small">
                  Broche RX: -1 à 48
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Boutons d'action -->
        <div class="mt-3 d-flex gap-2 justify-content-end">
          <button type="button" class="btn btn-outline-secondary" id="device-uart-reset">
            <i class="ti ti-reload me-1"></i>
            Réinitialiser
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="ti ti-device-floppy me-1"></i>
            Enregistrer
          </button>
        </div>
      </form>
    </div>

    <!-- Onglet 2: Wi-Fi Station -->
    <div class="tab-pane fade" id="wifi-sta" role="tabpanel" aria-labelledby="wifi-sta-tab">
      <form id="wifi-sta-form">
        <div class="card bg-dark border border-secondary">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="ti ti-wifi me-2"></i>
              Configuration Wi-Fi Station
            </h4>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6 col-xl-3">
                <label for="wifi-sta-ssid" class="form-label">
                  <span>SSID</span>
                </label>
                <input id="wifi-sta-ssid" name="wifi_sta_ssid" 
                       type="text" class="form-control" maxlength="32">
                <div class="form-hint text-muted small">
                  Nom du réseau Wi-Fi
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="wifi-sta-password" class="form-label">
                  <span>Mot de passe</span>
                </label>
                <input id="wifi-sta-password" name="wifi_sta_password" 
                       type="password" class="form-control" 
                       maxlength="64" autocomplete="new-password">
                <div class="form-hint text-muted small">
                  Mot de passe Wi-Fi
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="wifi-sta-hostname" class="form-label">
                  <span>Nom d'hôte</span>
                </label>
                <input id="wifi-sta-hostname" name="wifi_sta_hostname" 
                       type="text" class="form-control" maxlength="32">
                <div class="form-hint text-muted small">
                  Hostname sur le réseau
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="wifi-sta-max-retry" class="form-label">
                  <span>Tentatives de connexion</span>
                </label>
                <input id="wifi-sta-max-retry" name="wifi_sta_max_retry" 
                       type="number" class="form-control" 
                       min="0" max="255" required>
                <div class="form-hint text-muted small">
                  0 - 255 tentatives
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Boutons d'action -->
        <div class="mt-3 d-flex gap-2 justify-content-end">
          <button type="button" class="btn btn-outline-secondary" id="wifi-sta-reset">
            <i class="ti ti-reload me-1"></i>
            Réinitialiser
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="ti ti-device-floppy me-1"></i>
            Enregistrer
          </button>
        </div>
      </form>
    </div>

    <!-- Onglet 3: Wi-Fi Point d'Accès -->
    <div class="tab-pane fade" id="wifi-ap" role="tabpanel" aria-labelledby="wifi-ap-tab">
      <form id="wifi-ap-form">
        <div class="card bg-dark border border-secondary">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="ti ti-router me-2"></i>
              Configuration Wi-Fi Point d'Accès
            </h4>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6 col-xl-3">
                <label for="wifi-ap-ssid" class="form-label">
                  <span>SSID</span>
                </label>
                <input id="wifi-ap-ssid" name="wifi_ap_ssid" 
                       type="text" class="form-control" maxlength="32">
                <div class="form-hint text-muted small">
                  Nom du point d'accès
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="wifi-ap-password" class="form-label">
                  <span>Mot de passe</span>
                </label>
                <input id="wifi-ap-password" name="wifi_ap_password" 
                       type="password" class="form-control" 
                       maxlength="64" autocomplete="new-password">
                <div class="form-hint text-muted small">
                  Min. 8 caractères
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="wifi-ap-channel" class="form-label">
                  <span>Canal Wi-Fi</span>
                </label>
                <input id="wifi-ap-channel" name="wifi_ap_channel" 
                       type="number" class="form-control" 
                       min="1" max="13" required>
                <div class="form-hint text-muted small">
                  Canal 1 - 13
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="wifi-ap-max-clients" class="form-label">
                  <span>Clients simultanés</span>
                </label>
                <input id="wifi-ap-max-clients" name="wifi_ap_max_clients" 
                       type="number" class="form-control" 
                       min="1" max="10" required>
                <div class="form-hint text-muted small">
                  1 - 10 clients max
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Boutons d'action -->
        <div class="mt-3 d-flex gap-2 justify-content-end">
          <button type="button" class="btn btn-outline-secondary" id="wifi-ap-reset">
            <i class="ti ti-reload me-1"></i>
            Réinitialiser
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="ti ti-device-floppy me-1"></i>
            Enregistrer
          </button>
        </div>
      </form>
    </div>

    <!-- Onglet 4: Bus CAN Victron -->
    <div class="tab-pane fade" id="can-bus" role="tabpanel" aria-labelledby="can-bus-tab">
      <form id="can-bus-form">
        <div class="card bg-dark border border-secondary">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="ti ti-network me-2"></i>
              Configuration Bus CAN Victron
            </h4>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6 col-xl-3">
                <label for="can-tx-gpio" class="form-label">
                  <span>GPIO CAN TX</span>
                </label>
                <input id="can-tx-gpio" name="can_tx_gpio" 
                       type="number" class="form-control" 
                       min="-1" max="39" required>
                <div class="form-hint text-muted small">
                  Broche TX CAN: -1 à 39
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-rx-gpio" class="form-label">
                  <span>GPIO CAN RX</span>
                </label>
                <input id="can-rx-gpio" name="can_rx_gpio" 
                       type="number" class="form-control" 
                       min="-1" max="39" required>
                <div class="form-hint text-muted small">
                  Broche RX CAN: -1 à 39
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-keepalive-interval" class="form-label">
                  <span>Keepalive (ms)</span>
                </label>
                <input id="can-keepalive-interval" name="can_keepalive_interval_ms" 
                       type="number" class="form-control" 
                       min="10" max="600000" step="10" required>
                <div class="form-hint text-muted small">
                  Intervalle keepalive
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-keepalive-timeout" class="form-label">
                  <span>Expiration (ms)</span>
                </label>
                <input id="can-keepalive-timeout" name="can_keepalive_timeout_ms" 
                       type="number" class="form-control" 
                       min="100" max="600000" step="10" required>
                <div class="form-hint text-muted small">
                  Timeout keepalive
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-keepalive-retry" class="form-label">
                  <span>Relance (ms)</span>
                </label>
                <input id="can-keepalive-retry" name="can_keepalive_retry_ms" 
                       type="number" class="form-control" 
                       min="10" max="600000" step="10" required>
                <div class="form-hint text-muted small">
                  Délai de relance
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-publisher-period" class="form-label">
                  <span>Période publication (ms)</span>
                </label>
                <input id="can-publisher-period" name="can_publisher_period_ms" 
                       type="number" class="form-control" 
                       min="0" max="600000" step="10" required>
                <div class="form-hint text-muted small">
                  Intervalle de publication
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Boutons d'action -->
        <div class="mt-3 d-flex gap-2 justify-content-end">
          <button type="button" class="btn btn-outline-secondary" id="can-bus-reset">
            <i class="ti ti-reload me-1"></i>
            Réinitialiser
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="ti ti-device-floppy me-1"></i>
            Enregistrer
          </button>
        </div>
      </form>
    </div>

    <!-- Onglet 5: Identité Victron -->
    <div class="tab-pane fade" id="identity" role="tabpanel" aria-labelledby="identity-tab">
      <form id="identity-form">
        <div class="card bg-dark border border-secondary">
          <div class="card-header">
            <h4 class="card-title mb-0">
              <i class="ti ti-id me-2"></i>
              Configuration Identité Victron
            </h4>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6 col-xl-3">
                <label for="can-handshake" class="form-label">
                  <span>Handshake ASCII</span>
                </label>
                <input id="can-handshake" name="can_handshake_ascii" 
                       type="text" class="form-control" maxlength="8">
                <div class="form-hint text-muted small">
                  Code handshake (max 8 car.)
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-manufacturer" class="form-label">
                  <span>Constructeur</span>
                </label>
                <input id="can-manufacturer" name="can_manufacturer" 
                       type="text" class="form-control" maxlength="32">
                <div class="form-hint text-muted small">
                  Nom du fabricant
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-battery-name" class="form-label">
                  <span>Nom batterie</span>
                </label>
                <input id="can-battery-name" name="can_battery_name" 
                       type="text" class="form-control" maxlength="32">
                <div class="form-hint text-muted small">
                  Nom de la batterie
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-battery-family" class="form-label">
                  <span>Famille batterie</span>
                </label>
                <input id="can-battery-family" name="can_battery_family" 
                       type="text" class="form-control" maxlength="32">
                <div class="form-hint text-muted small">
                  Famille/Type de batterie
                </div>
              </div>
              
              <div class="col-md-6 col-xl-3">
                <label for="can-serial-number" class="form-label">
                  <span>Numéro de série</span>
                </label>
                <input id="can-serial-number" name="can_serial_number" 
                       type="text" class="form-control" maxlength="32">
                <div class="form-hint text-muted small">
                  S/N de la batterie
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Boutons d'action -->
        <div class="mt-3 d-flex gap-2 justify-content-end">
          <button type="button" class="btn btn-outline-secondary" id="identity-reset">
            <i class="ti ti-reload me-1"></i>
            Réinitialiser
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="ti ti-device-floppy me-1"></i>
            Enregistrer
          </button>
        </div>
      </form>
    </div>

  </div>


<!-- Script de gestion de la configuration ESP32 -->
<script src="/src/components/configuration/esp32-config.js"></script>

</section>
