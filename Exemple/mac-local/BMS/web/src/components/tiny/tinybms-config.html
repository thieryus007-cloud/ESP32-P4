<style>
  /* Styles pour l'interface Tiny */
  #tinybms-config-content .form-label {
    color: white !important;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
  }

  #tinybms-config-content .form-label .register-number {
    color: #6c757d;
    font-size: 0.875rem;
    font-weight: normal;
  }

  #tinybms-config-content .form-control,
  #tinybms-config-content .form-select {
    max-width: 9em;
    display: inline-block;
  }

  #tinybms-config-content .form-hint {
    color: #adb5bd !important;
    margin-top: 0.25rem;
  }

  #tinybms-config-content .form-check-label {
    color: white !important;
  }

  #tinybms-config-content h4 {
    color: white !important;
  }

  #tinybms-config-content .field-with-current {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  #tinybms-config-content .current-value {
    color: #8ab4f8;
    font-size: 0.875rem;
    white-space: nowrap;
  }

  #tinybms-config-content .current-value-label {
    color: #6c757d;
    margin-right: 0.25rem;
  }

  /* Réduction de la largeur des champs config générale */
  #general-config-form .form-control,
  #general-config-form .form-select {
    max-width: 9em;
  }
</style>

<div class="card mt-4">
  <div class="card-header">
    <div>
      <h3 class="card-title mb-0">
        <i class="ti ti-settings-cog me-2"></i>
        Configuration TinyBMS
      </h3>
      <p class="card-subtitle text-secondary mb-0 mt-2">
        Configurez les paramètres cellules, sécurité et périphériques.
      </p>
    </div>
  </div>
  <div class="card-body">
    <!-- Sub-navigation tabs -->
    <ul class="nav nav-tabs nav-fill mb-4" id="tinybms-config-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="cell-settings-tab" data-bs-toggle="tab" data-bs-target="#cell-settings" type="button" role="tab" aria-controls="cell-settings" aria-selected="true">
          <i class="ti ti-battery-4 me-2"></i>
          Cell Settings
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="safety-tab" data-bs-toggle="tab" data-bs-target="#safety" type="button" role="tab" aria-controls="safety" aria-selected="false">
          <i class="ti ti-shield-check me-2"></i>
          Safety
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="peripherals-tab" data-bs-toggle="tab" data-bs-target="#peripherals" type="button" role="tab" aria-controls="peripherals" aria-selected="false">
          <i class="ti ti-plug-connected me-2"></i>
          Peripherals
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="maintenance-tab" data-bs-toggle="tab" data-bs-target="#maintenance" type="button" role="tab" aria-controls="maintenance" aria-selected="false">
          <i class="ti ti-tool me-2"></i>
          Maintenance
        </button>
      </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content" id="tinybms-config-content">
      <!-- Cell Settings Tab -->
      <div class="tab-pane fade show active" id="cell-settings" role="tabpanel" aria-labelledby="cell-settings-tab">
        <form id="tinybms-cell-settings-form">
          <div class="row g-4">
            <!-- Cell Settings (All in One) -->
            <div class="col-12">
              <h4 class="text-secondary text-uppercase fs-6 mb-3">
                <i class="ti ti-battery-4 me-2"></i>
                Cell Settings
              </h4>
              <div class="card bg-dark border border-secondary">
                <div class="card-body">
                  <div class="row g-3">
                    <!-- Reg 300 -->
                    <div class="col-lg-4">
                      <label for="fully-charged-voltage" class="form-label">
                        <span>Fully Charged Voltage (V)</span>
                        <span class="register-number">Reg: 300</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="fully-charged-voltage" step="0.001" min="2.5" max="4.5" data-register="300" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-fully-charged-voltage">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Min: (Fully Discharged + 0.01V) • Max: (Over-Voltage Cutoff - 0.01V)
                      </div>
                    </div>

                    <!-- Reg 301 -->
                    <div class="col-lg-4">
                      <label for="fully-discharged-voltage" class="form-label">
                        <span>Fully Discharged Voltage (V)</span>
                        <span class="register-number">Reg: 301</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="fully-discharged-voltage" step="0.001" min="2.0" max="4.0" data-register="301" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-fully-discharged-voltage">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Min: (Under-Voltage Cutoff + 0.01V) • Max: (Fully Charged - 0.01V)
                      </div>
                    </div>

                    <!-- Reg 303 -->
                    <div class="col-lg-4">
                      <label for="early-balancing-threshold" class="form-label">
                        <span>Early Balancing Threshold (V)</span>
                        <span class="register-number">Reg: 303</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="early-balancing-threshold" step="0.001" min="1.0" max="4.5" data-register="303" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-early-balancing-threshold">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: 1.0V - 4.5V
                      </div>
                    </div>

                    <!-- Reg 304 -->
                    <div class="col-lg-4">
                      <label for="charge-finished-current" class="form-label">
                        <span>Charge Finished Current (A)</span>
                        <span class="register-number">Reg: 304</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="charge-finished-current" step="0.1" min="0.1" max="150" data-register="304" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charge-finished-current">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Dépend du type de PCB et du capteur de courant
                      </div>
                    </div>

                    <!-- Reg 306 -->
                    <div class="col-lg-4">
                      <label for="battery-capacity" class="form-label">
                        <span>Battery Capacity (Ah)</span>
                        <span class="register-number">Reg: 306</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="battery-capacity" step="0.1" min="0.1" max="655" data-register="306" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-battery-capacity">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: 0.1Ah - 655Ah
                      </div>
                    </div>

                    <!-- Reg 307 -->
                    <div class="col-lg-4">
                      <label for="number-of-series-cells" class="form-label">
                        <span>Number of Series Cells</span>
                        <span class="register-number">Reg: 307</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="number-of-series-cells" step="1" min="4" max="16" data-register="307" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-number-of-series-cells">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: 4 - 16 cellules
                      </div>
                    </div>

                    <!-- Reg 308 -->
                    <div class="col-lg-4">
                      <label for="allowed-disbalance" class="form-label">
                        <span>Allowed Disbalance (mV)</span>
                        <span class="register-number">Reg: 308</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="allowed-disbalance" step="1" min="15" max="100" data-register="308" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-allowed-disbalance">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: 15mV - 100mV
                      </div>
                    </div>

                    <!-- Reg 322 -->
                    <div class="col-lg-4">
                      <label for="battery-maximum-cycles" class="form-label">
                        <span>Battery Maximum Cycles Count</span>
                        <span class="register-number">Reg: 322</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="battery-maximum-cycles" step="1" min="1" max="100000" data-register="322" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-battery-maximum-cycles">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Cycles avant dégradation significative
                      </div>
                    </div>

                    <!-- Reg 323 -->
                    <div class="col-lg-4">
                      <label for="set-soh-manually" class="form-label">
                        <span>Set SOH manually (%)</span>
                        <span class="register-number">Reg: 323</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="set-soh-manually" step="1" min="0" max="100" data-register="323" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-set-soh-manually">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: 0% - 100%
                      </div>
                    </div>

                    <!-- Reg 328 -->
                    <div class="col-lg-4">
                      <label for="set-soc-manually" class="form-label">
                        <span>Set SOC manually (%)</span>
                        <span class="register-number">Reg: 328</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="set-soc-manually" step="1" min="0" max="100" data-register="328" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-set-soc-manually">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: 0% - 100%
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action buttons -->
            <div class="col-12">
              <div class="d-flex gap-2 justify-content-end">
                <button type="button" class="btn btn-outline-secondary" id="cell-settings-reset">
                  <i class="ti ti-reload me-1"></i>
                  Réinitialiser
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="ti ti-device-floppy me-1"></i>
                  Upload To BMS
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Safety Tab -->
      <div class="tab-pane fade" id="safety" role="tabpanel" aria-labelledby="safety-tab">
        <form id="tinybms-safety-form">
          <div class="row g-4">
            <!-- Safety Settings (All in One) -->
            <div class="col-12">
              <h4 class="text-secondary text-uppercase fs-6 mb-3">
                <i class="ti ti-shield-check me-2"></i>
                Safety Settings
              </h4>
              <div class="card bg-dark border border-secondary">
                <div class="card-body">
                  <div class="row g-3">
                    <!-- Reg 305 -->
                    <div class="col-lg-4">
                      <label for="discharge-peak-current-cutoff" class="form-label">
                        <span>Discharge Peak-Current Cutoff (A)</span>
                        <span class="register-number">Reg: 305</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="discharge-peak-current-cutoff" step="1" min="1" max="500" data-register="305" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-discharge-peak-current-cutoff">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Doit être > Discharge Over-Current Cutoff
                      </div>
                    </div>

                    <!-- Reg 315 -->
                    <div class="col-lg-4">
                      <label for="over-voltage-cutoff" class="form-label">
                        <span>Over-Voltage Cutoff (V)</span>
                        <span class="register-number">Reg: 315</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="over-voltage-cutoff" step="0.001" min="3.0" max="4.5" data-register="315" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-over-voltage-cutoff">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Min: (Fully Charged + 0.01V) • Max: 4.5V
                      </div>
                    </div>

                    <!-- Reg 316 -->
                    <div class="col-lg-4">
                      <label for="under-voltage-cutoff" class="form-label">
                        <span>Under-Voltage Cutoff (V)</span>
                        <span class="register-number">Reg: 316</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="under-voltage-cutoff" step="0.001" min="0.8" max="3.5" data-register="316" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-under-voltage-cutoff">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Min: 0.8V • Max: (Fully Discharged - 0.01V)
                      </div>
                    </div>

                    <!-- Reg 317 -->
                    <div class="col-lg-4">
                      <label for="discharge-over-current-cutoff" class="form-label">
                        <span>Discharge Over-Current Cutoff (A)</span>
                        <span class="register-number">Reg: 317</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="discharge-over-current-cutoff" step="1" min="1" max="300" data-register="317" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-discharge-over-current-cutoff">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Dépend du type de PCB, capteur et switch
                      </div>
                    </div>

                    <!-- Reg 318 -->
                    <div class="col-lg-4">
                      <label for="charge-over-current-cutoff" class="form-label">
                        <span>Charge Over-Current Cutoff (A)</span>
                        <span class="register-number">Reg: 318</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="charge-over-current-cutoff" step="1" min="1" max="300" data-register="318" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charge-over-current-cutoff">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Dépend du type de PCB, capteur et switch
                      </div>
                    </div>

                    <!-- Reg 319 -->
                    <div class="col-lg-4">
                      <label for="over-heat-cutoff" class="form-label">
                        <span>Over-Heat Cutoff (°C)</span>
                        <span class="register-number">Reg: 319</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="over-heat-cutoff" step="1" min="20" max="90" data-register="319" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-over-heat-cutoff">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: 20°C - 90°C
                      </div>
                    </div>

                    <!-- Reg 320 -->
                    <div class="col-lg-4">
                      <label for="low-temp-charger-cutoff" class="form-label">
                        <span>Low Temperature Charger Cutoff (°C)</span>
                        <span class="register-number">Reg: 320</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="low-temp-charger-cutoff" step="1" min="-40" max="10" data-register="320" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-low-temp-charger-cutoff">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Plage: -40°C - 10°C
                      </div>
                    </div>

                    <!-- Reg 329 -->
                    <div class="col-lg-4">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="invert-current-sensor" data-register="329" role="switch">
                        <label class="form-check-label" for="invert-current-sensor">
                          Invert External Current Sensor Direction
                          <span class="register-number ms-2">Reg: 329</span>
                        </label>
                      </div>
                      <div class="form-hint text-muted small">
                        Inverse les lectures de courant
                      </div>
                    </div>

                    <!-- Reg 332 -->
                    <div class="col-lg-4">
                      <label for="automatic-recovery" class="form-label">
                        <span>Automatic Recovery (s)</span>
                        <span class="register-number">Reg: 332</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="automatic-recovery" step="1" min="0" max="30" data-register="332" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-automatic-recovery">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        0 = désactivé • 1-30s = délai de récupération
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action buttons -->
            <div class="col-12">
              <div class="d-flex gap-2 justify-content-end">
                <button type="button" class="btn btn-outline-secondary" id="safety-reset">
                  <i class="ti ti-reload me-1"></i>
                  Réinitialiser
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="ti ti-device-floppy me-1"></i>
                  Upload To BMS
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Peripherals Tab -->
      <div class="tab-pane fade" id="peripherals" role="tabpanel" aria-labelledby="peripherals-tab">
        <form id="tinybms-peripherals-form">
          <div class="row g-4">
            <!-- Peripherals Settings (All in One) -->
            <div class="col-12">
              <h4 class="text-secondary text-uppercase fs-6 mb-3">
                <i class="ti ti-plug-connected me-2"></i>
                Peripherals Settings
              </h4>
              <div class="card bg-dark border border-secondary">
                <div class="card-body">
                  <div class="row g-3">
                    <!-- Reg 310 -->
                    <div class="col-lg-4">
                      <label for="charger-startup-delay" class="form-label">
                        <span>Charger Startup Delay (s)</span>
                        <span class="register-number">Reg: 310</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="charger-startup-delay" step="1" min="0" max="60" value="20" data-register="310" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charger-startup-delay">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Délai avant coupure si pas de courant détecté
                      </div>
                    </div>

                    <!-- Reg 311 -->
                    <div class="col-lg-4">
                      <label for="charger-disable-delay" class="form-label">
                        <span>Charger Disable Delay (s)</span>
                        <span class="register-number">Reg: 311</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="charger-disable-delay" step="1" min="0" max="60" value="5" data-register="311" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charger-disable-delay">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Délai avant désactivation après déconnexion
                      </div>
                    </div>

                    <!-- Reg 321 -->
                    <div class="col-lg-4">
                      <label for="charge-restart-level" class="form-label">
                        <span>Charge Restart Level (%)</span>
                        <span class="register-number">Reg: 321</span>
                      </label>
                      <div class="field-with-current">
                        <input type="number" class="form-control" id="charge-restart-level" step="1" min="60" max="95" value="90" data-register="321" required>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charge-restart-level">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        SOC minimum pour redémarrage automatique
                      </div>
                    </div>

                    <!-- Reg 330 -->
                    <div class="col-lg-4">
                      <label for="charger-type" class="form-label">
                        <span>Charger Type</span>
                        <span class="register-number">Reg: 330</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="charger-type" data-register="330" required>
                          <option value="generic-cc-cv" selected>Generic CC/CV</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charger-type">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 331 -->
                    <div class="col-lg-4" id="load-settings-group">
                      <label for="load-switch-type" class="form-label">
                        <span>Load Switch Type</span>
                        <span class="register-number">Reg: 331</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="load-switch-type" data-register="331" required>
                          <option value="discharge-fet">Discharge FET</option>
                          <option value="aido1">AIDO1 (External)</option>
                          <option value="dido1">DIDO1 (External)</option>
                          <option value="aiho1">AIHO1 (External)</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-load-switch-type">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 333 -->
                    <div class="col-lg-4" id="charger-switch-type-group">
                      <label for="charger-switch-type" class="form-label">
                        <span>Charger Switch Type</span>
                        <span class="register-number">Reg: 333</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="charger-switch-type" data-register="333" required>
                          <option value="charge-fet" selected>Charge FET</option>
                          <option value="aido1">AIDO1 (External)</option>
                          <option value="dido1">DIDO1 (External)</option>
                          <option value="aiho1">AIHO1 (External)</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charger-switch-type">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 334 -->
                    <div class="col-lg-4">
                      <label for="ignition" class="form-label">
                        <span>Ignition</span>
                        <span class="register-number">Reg: 334</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="ignition" data-register="334" required>
                          <option value="disabled">Disabled</option>
                          <option value="aido1">AIDO1</option>
                          <option value="dido1">DIDO1</option>
                          <option value="aiho1">AIHO1</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-ignition">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 335 -->
                    <div class="col-lg-4">
                      <label for="charger-detection" class="form-label">
                        <span>Charger Detection</span>
                        <span class="register-number">Reg: 335</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="charger-detection" data-register="335" required>
                          <option value="internal" selected>Internal</option>
                          <option value="aido1">AIDO1 (External)</option>
                          <option value="dido1">DIDO1 (External)</option>
                          <option value="aiho1">AIHO1 (External)</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-charger-detection">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 337 -->
                    <div class="col-lg-4">
                      <label for="precharge" class="form-label">
                        <span>Precharge</span>
                        <span class="register-number">Reg: 337</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="precharge" data-register="337" required>
                          <option value="disabled">Disabled</option>
                          <option value="discharge-fet">Discharge FET</option>
                          <option value="aido1">AIDO1</option>
                          <option value="dido1">DIDO1</option>
                          <option value="aiho1">AIHO1</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-precharge">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 338 -->
                    <div class="col-lg-4">
                      <label for="precharge-duration" class="form-label">
                        <span>Precharge Duration</span>
                        <span class="register-number">Reg: 338</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="precharge-duration" data-register="338" required>
                          <option value="0.1">0.1 s</option>
                          <option value="0.2">0.2 s</option>
                          <option value="0.5">0.5 s</option>
                          <option value="1.0" selected>1.0 s</option>
                          <option value="2.0">2.0 s</option>
                          <option value="3.0">3.0 s</option>
                          <option value="4.0">4.0 s</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-precharge-duration">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 339 -->
                    <div class="col-lg-4">
                      <label for="temperature-sensor-type" class="form-label">
                        <span>Temperature Sensor Type</span>
                        <span class="register-number">Reg: 339</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="temperature-sensor-type" data-register="339" required>
                          <option value="dual-10k-ntc" selected>Dual 10K NTC Sensor</option>
                          <option value="multipoint-active">Multipoint Active Sensor</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-temperature-sensor-type">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Dual 10K NTC: 10K @ 25°C, Beta 3977K
                      </div>
                    </div>

                    <!-- Reg 340 -->
                    <div class="col-lg-4">
                      <label for="bms-mode" class="form-label">
                        <span>BMS Operation Mode</span>
                        <span class="register-number">Reg: 340</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="bms-mode" data-register="340" required>
                          <option value="dual-port">Dual Port</option>
                          <option value="single-port">Single Port</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-bms-mode">--</span>
                        </span>
                      </div>
                      <div class="form-hint text-muted small">
                        Dual: switches séparés • Single: switch commun
                      </div>
                    </div>

                    <!-- Reg 341 -->
                    <div class="col-lg-4" id="single-port-switch-type-group" style="display: none;">
                      <label for="single-port-switch-type" class="form-label">
                        <span>Single Port Switch Type</span>
                        <span class="register-number">Reg: 341</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="single-port-switch-type" data-register="341">
                          <option value="internal-fet">Internal FET</option>
                          <option value="aido1">AIDO1 (External)</option>
                          <option value="dido1">DIDO1 (External)</option>
                          <option value="aiho1">AIHO1 (External)</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-single-port-switch-type">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 342 -->
                    <div class="col-lg-4">
                      <label for="broadcast" class="form-label">
                        <span>Broadcast Interval</span>
                        <span class="register-number">Reg: 342</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="broadcast" data-register="342" required>
                          <option value="disabled" selected>Disabled</option>
                          <option value="0.1">0.1 s</option>
                          <option value="0.2">0.2 s</option>
                          <option value="0.5">0.5 s</option>
                          <option value="1.0">1.0 s</option>
                          <option value="2.0">2.0 s</option>
                          <option value="5.0">5.0 s</option>
                          <option value="10.0">10.0 s</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-broadcast">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- Reg 343 -->
                    <div class="col-lg-4">
                      <label for="protocol" class="form-label">
                        <span>Broadcast Protocol</span>
                        <span class="register-number">Reg: 343</span>
                      </label>
                      <div class="field-with-current">
                        <select class="form-select" id="protocol" data-register="343" required>
                          <option value="cav3">CA V3 (Ebike Analyzer)</option>
                          <option value="ascii">ASCII</option>
                          <option value="soc-bar">SOC BAR</option>
                        </select>
                        <span class="current-value">
                          <span class="current-value-label">Actuel:</span>
                          <span id="current-protocol">--</span>
                        </span>
                      </div>
                    </div>

                    <!-- External Current Sensor (no register) -->
                    <div class="col-lg-4">
                      <label for="external-current-sensor" class="form-label">
                        <span>External Current Sensor</span>
                      </label>
                      <select class="form-select" id="external-current-sensor" required>
                        <option value="none" selected>None (Internal HALL)</option>
                        <option value="dhab-s133-75a">DHAB S/133 (75A/750A)</option>
                        <option value="dhab-s124-200a">DHAB S/124 (200A)</option>
                        <option value="lem-hass-200s">LEM HASS 200-S</option>
                        <option value="lem-hass-300s">LEM HASS 300-S</option>
                        <option value="lem-hass-400s">LEM HASS 400-S</option>
                      </select>
                      <div class="form-hint text-muted small">
                        Nécessite BMS 150A haute puissance
                      </div>
                    </div>

                    <!-- Enable Charger Restart Level (checkbox, no register) -->
                    <div class="col-12">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="enable-charger-restart-level" role="switch">
                        <label class="form-check-label" for="enable-charger-restart-level">
                          Enable Charger Restart Level
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action buttons -->
            <div class="col-12">
              <div class="d-flex gap-2 justify-content-end">
                <button type="button" class="btn btn-outline-secondary" id="peripherals-reset">
                  <i class="ti ti-reload me-1"></i>
                  Réinitialiser
                </button>
                <button type="submit" class="btn btn-primary">
                  <i class="ti ti-device-floppy me-1"></i>
                  Upload To BMS
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Maintenance Tab -->
      <div class="tab-pane fade" id="maintenance" role="tabpanel" aria-labelledby="maintenance-tab">
        <div class="row g-4">
          <!-- BMS Configuration -->
          <div class="col-lg-4">
            <h4 class="text-secondary text-uppercase fs-6 mb-3">
              <i class="ti ti-file-settings me-2"></i>
              BMS Configuration
            </h4>
            <div class="card bg-dark border border-secondary">
              <div class="card-body">
                <div class="d-flex flex-column gap-3">
                  <button type="button" class="btn btn-outline-primary" id="load-config-from-file">
                    <i class="ti ti-file-upload me-2"></i>
                    Load Configuration From File
                  </button>
                  <button type="button" class="btn btn-outline-primary" id="save-config-to-file">
                    <i class="ti ti-file-download me-2"></i>
                    Save Configuration To File
                  </button>
                  <button type="button" class="btn btn-primary" id="upload-config-to-bms">
                    <i class="ti ti-upload me-2"></i>
                    Upload Configuration To BMS
                  </button>
                  <div class="alert alert-info mb-0" role="status">
                    <i class="ti ti-info-circle me-2"></i>
                    <span id="config-status-text">No Action</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Firmware Update -->
          <div class="col-lg-4">
            <h4 class="text-secondary text-uppercase fs-6 mb-3">
              <i class="ti ti-refresh-alert me-2"></i>
              Firmware Update
            </h4>
            <div class="card bg-dark border border-secondary">
              <div class="card-body">
                <div class="d-flex flex-column gap-3">
                  <button type="button" class="btn btn-warning" id="update-bms-firmware">
                    <i class="ti ti-cloud-upload me-2"></i>
                    Update BMS Firmware
                  </button>
                  <div class="progress" style="height: 24px; display: none;" id="firmware-progress-container">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" id="firmware-progress" style="width: 0%">0%</div>
                  </div>
                  <div class="alert alert-secondary mb-0" role="status">
                    <i class="ti ti-circle-check me-2"></i>
                    Status: <span id="firmware-status-text">Idle</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- BMS Restart -->
          <div class="col-lg-4">
            <h4 class="text-secondary text-uppercase fs-6 mb-3">
              <i class="ti ti-rotate-clockwise me-2"></i>
              Maintenance
            </h4>
            <div class="card bg-danger-lt border border-danger">
              <div class="card-body">
                <div class="alert alert-warning" role="alert">
                  <h4 class="alert-title">
                    <i class="ti ti-alert-triangle me-2"></i>
                    Required BMS restart:
                  </h4>
                  <ul class="mb-0">
                    <li>After an external current sensor was connected or disconnected</li>
                    <li>To recover from incorrect BMS state (e.g. Under-Voltage fault after initial connection)</li>
                    <li>After BMS firmware malfunction occurred</li>
                  </ul>
                </div>
                <button type="button" class="btn btn-danger w-100" id="restart-bms">
                  <i class="ti ti-power me-2"></i>
                  Restart BMS
                </button>
              </div>
            </div>
          </div>

          <!-- Versions -->
          <div class="col-lg-4">
            <h4 class="text-secondary text-uppercase fs-6 mb-3">
              <i class="ti ti-info-square me-2"></i>
              Versions
            </h4>
            <div class="card bg-dark border border-secondary">
              <div class="card-body">
                <dl class="row g-2 mb-0">
                  <dt class="col-6 text-secondary">Battery Insider Version</dt>
                  <dd class="col-6 mb-0 text-end fw-semibold" id="battery-insider-version">v2.5.3.1</dd>

                  <dt class="col-6 text-secondary">Firmware Version</dt>
                  <dd class="col-6 mb-0 text-end fw-semibold" id="firmware-version">--</dd>

                  <dt class="col-6 text-secondary">Hardware Version</dt>
                  <dd class="col-6 mb-0 text-end fw-semibold" id="hardware-version">--</dd>

                  <dt class="col-6 text-secondary">Product Version</dt>
                  <dd class="col-6 mb-0 text-end fw-semibold" id="product-version">--</dd>

                  <dt class="col-6 text-secondary">Hardware S/N</dt>
                  <dd class="col-6 mb-0 text-end fw-semibold text-wrap" id="hardware-serial">--</dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Suivi de la configuration -->
    <div class="mt-4 pt-4 border-top">
      <h4 class="text-secondary text-uppercase fs-6 mb-3">
        <i class="ti ti-activity me-2"></i>
        Suivi de la Configuration
      </h4>
      <div class="card bg-dark border border-secondary">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="alert alert-info mb-3" role="alert">
                <i class="ti ti-info-circle me-2"></i>
                Les valeurs actuelles sont affichées à côté de chaque champ de configuration. Elles sont mises à jour automatiquement depuis le BMS.
              </div>
            </div>
            <div class="col-lg-4">
              <h5 class="text-white mb-3">État de la Configuration</h5>
              <dl class="row g-2 mb-0">
                <dt class="col-6 text-secondary">Dernière mise à jour</dt>
                <dd class="col-6 mb-0 text-end fw-semibold" id="config-last-update">--</dd>

                <dt class="col-6 text-secondary">Nombre de registres chargés</dt>
                <dd class="col-6 mb-0 text-end fw-semibold" id="config-registers-count">--</dd>

                <dt class="col-6 text-secondary">Statut de synchronisation</dt>
                <dd class="col-6 mb-0 text-end">
                  <span class="badge bg-secondary" id="config-sync-status">En attente</span>
                </dd>
              </dl>
            </div>
            <div class="col-lg-4">
              <h5 class="text-white mb-3">Actions Rapides</h5>
              <div class="d-flex flex-column gap-2">
                <button type="button" class="btn btn-sm btn-outline-primary" id="refresh-current-values">
                  <i class="ti ti-refresh me-1"></i>
                  Rafraîchir les Valeurs Actuelles
                </button>
                <button type="button" class="btn btn-sm btn-outline-info" id="compare-config">
                  <i class="ti ti-arrows-diff me-1"></i>
                  Comparer Configuration Actuelle vs BMS
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
