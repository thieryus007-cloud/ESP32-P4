<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ECharts</title>
    <style>
        body {
            background: #1e293b;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #gauge-container {
            width: 600px;
            height: 400px;
            background: #334155;
            margin: 20px 0;
            border: 2px solid #475569;
        }
        .log {
            background: #0f172a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>Test de chargement ECharts</h1>

    <div class="log" id="log"></div>

    <h2>Jauge de test</h2>
    <div id="gauge-container"></div>

    <button onclick="updateGauge(50)" style="padding: 10px 20px; margin: 5px;">Set 50%</button>
    <button onclick="updateGauge(75)" style="padding: 10px 20px; margin: 5px;">Set 75%</button>
    <button onclick="updateGauge(100)" style="padding: 10px 20px; margin: 5px;">Set 100%</button>

    <script src="/assets/js/echarts.simple.min.js"></script>
    <script>
        const logDiv = document.getElementById('log');

        function log(message, isError = false) {
            const time = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            logDiv.innerHTML += '<div class="' + className + '">[' + time + '] ' + message + '</div>';
            console.log(message);
        }

        log('Page chargée');

        setTimeout(function() {
            log('Vérification de window.echarts...');

            if (typeof window.echarts === 'undefined') {
                log('❌ window.echarts est undefined', true);
                return;
            }

            log('✅ window.echarts est disponible');

            try {
                const container = document.getElementById('gauge-container');
                log('Création du graphique...');

                const chart = window.echarts.init(container);
                log('✅ Graphique initialisé');

                const option = {
                    series: [{
                        type: 'gauge',
                        startAngle: 180,
                        endAngle: 0,
                        min: 0,
                        max: 100,
                        splitNumber: 8,
                        axisLine: {
                            lineStyle: {
                                width: 20,
                                color: [
                                    [0.5, '#ef4444'],
                                    [0.8, '#f59e0b'],
                                    [1, '#10b981']
                                ]
                            }
                        },
                        pointer: {
                            itemStyle: {
                                color: 'auto'
                            }
                        },
                        axisTick: {
                            distance: -30,
                            length: 8,
                            lineStyle: {
                                color: '#fff',
                                width: 2
                            }
                        },
                        splitLine: {
                            distance: -30,
                            length: 30,
                            lineStyle: {
                                color: '#fff',
                                width: 4
                            }
                        },
                        axisLabel: {
                            color: 'auto',
                            distance: 40,
                            fontSize: 16
                        },
                        detail: {
                            valueAnimation: true,
                            formatter: '{value}%',
                            color: 'auto',
                            fontSize: 40
                        },
                        data: [{
                            value: 25,
                            name: 'Test'
                        }]
                    }]
                };

                chart.setOption(option);
                log('✅ Options appliquées');

                window.testChart = chart;

                setTimeout(function() {
                    chart.setOption({
                        series: [{
                            data: [{ value: 75 }]
                        }]
                    });
                    log('✅ Mise à jour testée (75%)');
                }, 1000);

            } catch (e) {
                log('❌ Erreur: ' + e.message, true);
            }
        }, 200);

        function updateGauge(value) {
            if (window.testChart) {
                window.testChart.setOption({
                    series: [{
                        data: [{ value: value }]
                    }]
                });
                log('Valeur mise à jour: ' + value + '%');
            } else {
                log('❌ Chart non disponible', true);
            }
        }
    </script>
</body>
</html>
